<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Free Fire Tournament Points Table (With Placement Points)</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background-color: #f5f5f5;
      font-family: Arial, sans-serif;
    }
    table {
      border-collapse: collapse;
      width: 85%;
      max-width: 1100px;
      background-color: #fff;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      border-radius: 10px;
      overflow: hidden;
      text-align: center;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #333;
      padding: 10px;
    }
    th {
      background-color: #4CAF50;
      color: white;
      font-size: 18px;
    }
    tr:hover {
      background-color: #f1f1f1;
      transition: 0.3s;
    }
    td {
      font-size: 16px;
      color: #333;
    }
    td[contenteditable="true"] {
      background-color: #fafafa;
      cursor: text;
    }
    td[contenteditable="true"]:focus {
      outline: 2px solid #4CAF50;
    }
    .button-group {
      margin-top: 20px;
    }
    button {
      margin: 8px 5px;
      padding: 10px 18px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #45a049;
    }
  </style>
</head>

<body>

<div class="button-group">
  <button id="calculateButton">Calculate</button>
  <button id="nextButton">Next</button>
  <button id="finalButton">Final</button>
  <button id="resetButton">Reset</button>
  <button id="restoreButton">Restore Defaults</button>
</div>

<table id="pointsTable">
  <thead>
    <tr>
      <th>Rank</th>
      <th>Team Name</th>
      <th>Booyah</th>
      <th>Kill</th>
      <th>Placement Rank</th>
      <th>Placement Points</th>
      <th>Total</th>
    </tr>
  </thead>
  <tbody>
    <script>
      for (let i = 1; i <= 12; i++) {
        document.write('<tr>');
        document.write(`<td>${i}</td>`);
        document.write('<td contenteditable="true"></td>');
        document.write('<td contenteditable="true"></td>');
        document.write('<td contenteditable="true"></td>');
        document.write('<td contenteditable="true"></td>');
        document.write('<td></td>');
        document.write('<td></td>');
        document.write('</tr>');
      }
    </script>
  </tbody>
</table>

<script>
const table = document.getElementById('pointsTable');
let teamMemory = [];
let finalCalculated = false;

function checkBooyahExists() {
  const rows = table.querySelectorAll('tbody tr');
  for (let row of rows) {
    const booyah = parseInt(row.querySelectorAll('td')[2].innerText.trim()) || 0;
    if (booyah > 0) return true;
  }
  return false;
}

function validateInputs() {
  const booyahExists = checkBooyahExists();
  const rows = table.querySelectorAll('tbody tr');
  for (let row of rows) {
    const cells = row.querySelectorAll('td');
    const teamName = cells[1].innerText.trim();
    const booyah = cells[2].innerText.trim();
    const kill = cells[3].innerText.trim();
    const placement = cells[4].innerText.trim();

    if (teamName !== "") {
      if (booyah === "" && kill === "" && placement === "") {
        alert("âš ï¸ Insufficient values entered!");
        return false;
      }
      if (!booyahExists && placement === "") {
        alert("âš ï¸ Placement rank required when no Booyah exists!");
        return false;
      }
    }
  }
  return true;
}

function calculateRowTotal(row) {
  const cells = row.querySelectorAll('td');
  let booyah = parseInt(cells[2].innerText.trim()) || 0;
  let kill = parseInt(cells[3].innerText.trim()) || 0;
  let placementRank = parseInt(cells[4].innerText.trim()) || 0;
  let placementPoints = 0;

  if (booyah > 0) {
    placementPoints = 12;
    cells[4].innerText = 1; // auto placement
  } else {
    switch (placementRank) {
      case 1: placementPoints = 12; break;
      case 2: placementPoints = 9; break;
      case 3: placementPoints = 8; break;
      case 4: placementPoints = 7; break;
      case 5: placementPoints = 6; break;
      case 6: placementPoints = 5; break;
      case 7: placementPoints = 4; break;
      case 8: placementPoints = 3; break;
      case 9: placementPoints = 2; break;
      case 10: placementPoints = 1; break;
      default: placementPoints = 0;
    }
  }

  cells[5].innerText = placementPoints;
  cells[6].innerText = placementPoints + kill;
}

function realTimeUpdate() {
  const rows = table.querySelectorAll('tbody tr');
  rows.forEach(row => {
    [2, 3, 4].forEach(i => row.querySelectorAll('td')[i].addEventListener('input', () => calculateRowTotal(row)));
  });
}
realTimeUpdate();

function sortTable() {
  const tbody = table.querySelector('tbody');
  const rows = Array.from(tbody.querySelectorAll('tr'));
  rows.sort((a, b) => {
    const aTotal = parseInt(a.querySelectorAll('td')[6].innerText) || 0;
    const bTotal = parseInt(b.querySelectorAll('td')[6].innerText) || 0;
    return bTotal - aTotal;
  });
  rows.forEach((row, index) => {
    row.querySelector('td').innerText = index + 1;
    tbody.appendChild(row);
  });
}

document.getElementById('calculateButton').addEventListener('click', () => {
  if (!validateInputs()) return;
  sortTable();
});

document.getElementById('nextButton').addEventListener('click', () => {
  if (!validateInputs()) return;
  const rows = table.querySelectorAll('tbody tr');
  const matchData = [];
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    const teamName = cells[1].innerText.trim();
    const booyah = parseInt(cells[2].innerText.trim()) || 0;
    const kill = parseInt(cells[3].innerText.trim()) || 0;
    const placementPoints = parseInt(cells[5].innerText.trim()) || 0;
    if (teamName) matchData.push({ teamName, booyah, kill, placementPoints });
  });
  teamMemory.push(matchData);

  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    for (let i = 2; i <= 6; i++) cells[i].innerText = '';
  });

  finalCalculated = false;
  alert("âœ… Match saved! Enter next match data.");
});

// âœ… FIXED FINAL BUTTON: Only sums kills and placement points, not totals
document.getElementById('finalButton').addEventListener('click', () => {
  if (finalCalculated) {
    alert("âš ï¸ Final already calculated!");
    return;
  }
  if (!validateInputs()) return;

  // First, save the current match data
  const currentMatch = [];
  const rows = table.querySelectorAll('tbody tr');
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    const teamName = cells[1].innerText.trim();
    const booyah = parseInt(cells[2].innerText.trim()) || 0;
    const kill = parseInt(cells[3].innerText.trim()) || 0;
    const placementPoints = parseInt(cells[5].innerText.trim()) || 0;
    if (teamName) currentMatch.push({ teamName, booyah, kill, placementPoints });
  });
  
  // Add current match to memory
  teamMemory.push(currentMatch);

  const finalScores = {};

  // Sum only kills and placement points from ALL matches
  teamMemory.forEach(match => {
    match.forEach(team => {
      if (!finalScores[team.teamName]) {
        finalScores[team.teamName] = { 
          totalKills: 0, 
          totalPlacementPoints: 0,
          totalBooyahs: 0
        };
      }
      finalScores[team.teamName].totalKills += team.kill;
      finalScores[team.teamName].totalPlacementPoints += team.placementPoints;
      finalScores[team.teamName].totalBooyahs += team.booyah;
    });
  });

  // Display final results (kills + placement points = total)
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    const teamName = cells[1].innerText.trim();
    
    if (teamName && finalScores[teamName]) {
      const fs = finalScores[teamName];
      cells[2].innerText = fs.totalBooyahs;
      cells[3].innerText = fs.totalKills;
      cells[5].innerText = fs.totalPlacementPoints;
      // Total = kills + placement points (simple addition)
      cells[6].innerText = fs.totalKills + fs.totalPlacementPoints;
    } else {
      cells[2].innerText = 0;
      cells[3].innerText = 0;
      cells[5].innerText = 0;
      cells[6].innerText = 0;
    }
  });

  sortTable();
  finalCalculated = true;
  alert("ðŸ† Final Result Calculated! (Total = Kills + Placement Points)");
});

document.getElementById('resetButton').addEventListener('click', () => {
  if (!confirm("Reset all points but keep team names?")) return;
  teamMemory = [];
  finalCalculated = false;
  const rows = table.querySelectorAll('tbody tr');
  rows.forEach(row => {
    const cells = row.querySelectorAll('td');
    for (let i = 2; i <= 6; i++) cells[i].innerText = '';
  });
});

document.getElementById('restoreButton').addEventListener('click', () => {
  if (!confirm("âš ï¸ Restore default table (clear all data)?")) return;
  teamMemory = [];
  finalCalculated = false;
  const rows = table.querySelectorAll('tbody tr');
  rows.forEach((row, i) => {
    const cells = row.querySelectorAll('td');
    cells[0].innerText = i + 1;
    for (let j = 1; j <= 6; j++) cells[j].innerText = '';
  });
});
</script>
</body>
</html>
