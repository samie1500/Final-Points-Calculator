<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Free Fire Tournament - Points Table</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), 
                  url('https://images.unsplash.com/photo-1542751371-adc38448a05e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80') no-repeat center center fixed;
      background-size: cover;
      color: white;
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
      width: 100%;
    }

    .logo-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 20px;
    }

    .tournament-logo {
      height: 100px;
      width: auto;
      border-radius: 15px;
      box-shadow: 
        0 0 30px rgba(255, 215, 0, 0.6),
        0 0 60px rgba(255, 140, 0, 0.4),
        0 0 90px rgba(255, 69, 0, 0.2);
      border: 3px solid #FFD700;
      filter: brightness(1.1) contrast(1.1);
      transition: all 0.3s ease;
    }

    .tournament-logo:hover {
      transform: scale(1.05);
      box-shadow: 
        0 0 40px rgba(255, 215, 0, 0.8),
        0 0 80px rgba(255, 140, 0, 0.6),
        0 0 120px rgba(255, 69, 0, 0.4);
    }

    .tournament-title {
      font-size: 4rem;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: 4px;
      margin-bottom: 10px;
      text-shadow: 
        0 0 20px rgba(255, 215, 0, 0.8),
        0 0 40px rgba(255, 140, 0, 0.6),
        0 0 60px rgba(255, 69, 0, 0.4);
      color: #FFD700;
      background: linear-gradient(45deg, #FFD700, #FFA500, #FF8C00, #FF6347);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from {
        text-shadow: 
          0 0 20px rgba(255, 215, 0, 0.8),
          0 0 40px rgba(255, 140, 0, 0.6),
          0 0 60px rgba(255, 69, 0, 0.4);
      }
      to {
        text-shadow: 
          0 0 30px rgba(255, 215, 0, 1),
          0 0 60px rgba(255, 140, 0, 0.8),
          0 0 90px rgba(255, 69, 0, 0.6);
      }
    }

    .tournament-subtitle {
      font-size: 1.4rem;
      color: #FFA500;
      margin-bottom: 15px;
      letter-spacing: 3px;
      text-shadow: 0 0 10px rgba(255, 165, 0, 0.7);
      font-weight: 600;
      background: rgba(0, 0, 0, 0.3);
      padding: 8px 20px;
      border-radius: 25px;
      display: inline-block;
      backdrop-filter: blur(5px);
    }

    .pec-brand {
      font-size: 2.2rem;
      font-weight: 800;
      color: #FFD700;
      text-shadow: 
        0 0 15px rgba(255, 215, 0, 0.7),
        0 0 30px rgba(255, 140, 0, 0.5);
      background: linear-gradient(45deg, #FFD700, #FF8C00, #FF4500);
      -webkit-background-clip: text;
      letter-spacing: 2px;
      margin-top: 10px;
      padding: 10px 30px;
      border: 2px solid rgba(255, 215, 0, 0.3);
      border-radius: 50px;
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
    }

    .controls {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 30px;
      width: 100%;
      max-width: 900px;
    }

    .btn {
      padding: 12px 25px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    .btn-primary {
      background: linear-gradient(135deg, #4CAF50, #2E7D32);
      color: white;
    }

    .btn-warning {
      background: linear-gradient(135deg, #FF9800, #EF6C00);
      color: white;
    }

    .btn-danger {
      background: linear-gradient(135deg, #F44336, #C62828);
      color: white;
    }

    .btn-secondary {
      background: linear-gradient(135deg, #2196F3, #0D47A1);
      color: white;
    }

    .btn-success {
      background: linear-gradient(135deg, #9C27B0, #6A1B9A);
      color: white;
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
    }

    .btn:active {
      transform: translateY(1px);
    }

    .table-container {
      width: 100%;
      max-width: 1200px;
      background: rgba(10, 15, 30, 0.85);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      border: 2px solid rgba(255, 215, 0, 0.3);
      margin-bottom: 30px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      text-align: center;
    }

    thead {
      background: linear-gradient(135deg, rgba(255, 215, 0, 0.9), rgba(255, 140, 0, 0.9));
    }

    th {
      padding: 18px 15px;
      font-size: 18px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #1a1a2e;
      border-right: 1px solid rgba(255, 255, 255, 0.2);
    }

    th:last-child {
      border-right: none;
    }

    tbody tr {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      transition: background 0.3s ease;
    }

    tbody tr:hover {
      background: rgba(255, 215, 0, 0.1);
    }

    tbody tr:nth-child(even) {
      background: rgba(30, 40, 70, 0.5);
    }

    tbody tr:nth-child(even):hover {
      background: rgba(255, 215, 0, 0.15);
    }

    td {
      padding: 15px 10px;
      font-size: 16px;
      font-weight: 500;
      border-right: 1px solid rgba(255, 255, 255, 0.1);
    }

    td:last-child {
      border-right: none;
    }

    .rank-cell {
      font-weight: 700;
      font-size: 18px;
      color: #FFD700;
      background: rgba(0, 0, 0, 0.3);
    }

    .team-name {
      text-align: left;
      padding-left: 20px;
      font-weight: 600;
    }

    .total-cell {
      font-weight: 700;
      font-size: 18px;
      color: #4CAF50;
      background: rgba(0, 0, 0, 0.3);
    }

    input {
      width: 100%;
      padding: 8px 10px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 5px;
      color: white;
      text-align: center;
      font-size: 16px;
    }

    input:focus {
      outline: none;
      border-color: #FFD700;
      background: rgba(255, 255, 255, 0.15);
    }

    .footer {
      text-align: center;
      margin-top: 20px;
      color: rgba(255, 255, 255, 0.7);
      font-size: 14px;
      padding: 15px;
      width: 100%;
    }

    /* Download container styles */
    #downloadContainer {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(10, 15, 30, 0.95);
      padding: 30px;
      border-radius: 15px;
      border: 3px solid #FFD700;
      box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
      z-index: 1000;
      max-width: 90%;
      text-align: center;
    }

    #downloadPreview {
      background: linear-gradient(135deg, #1a1a2e, #16213e);
      padding: 30px;
      border-radius: 15px;
      border: 2px solid #FFD700;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    #downloadTable {
      background: white;
      color: black;
      border-collapse: collapse;
      width: 100%;
      margin: 20px 0;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    #downloadTable th {
      background: linear-gradient(135deg, #FFD700, #FF8C00);
      color: #1a1a2e;
      padding: 15px;
      font-size: 16px;
      font-weight: 700;
    }

    #downloadTable td {
      padding: 12px;
      border: 1px solid #ddd;
      color: #333;
      font-weight: 500;
    }

    #downloadTable .rank-cell {
      background: #fff9e6;
      color: #FF8C00;
      font-weight: bold;
    }

    #downloadTable .total-cell {
      background: #e8f5e8;
      color: #2E7D32;
      font-weight: bold;
    }

    .download-header {
      text-align: center;
      margin-bottom: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .download-logo {
      height: 80px;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
      border: 2px solid #FFD700;
      margin-bottom: 15px;
    }

    .download-title {
      color: #FFD700;
      font-size: 2.5rem;
      font-weight: 900;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
      margin: 10px 0;
    }

    .download-subtitle {
      color: #FFA500;
      font-size: 1.3rem;
      font-weight: 600;
      margin: 5px 0;
      background: rgba(0, 0, 0, 0.3);
      padding: 5px 15px;
      border-radius: 20px;
    }

    .download-brand {
      color: #FFD700;
      font-size: 1.8rem;
      font-weight: 800;
      text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
      margin: 10px 0;
      padding: 8px 20px;
      border: 1px solid rgba(255, 215, 0, 0.3);
      border-radius: 30px;
      display: inline-block;
      background: rgba(0, 0, 0, 0.3);
    }

    @media (max-width: 768px) {
      .table-container {
        overflow-x: auto;
      }
      
      table {
        min-width: 800px;
      }
      
      .controls {
        flex-direction: column;
        align-items: center;
      }
      
      .btn {
        width: 100%;
        max-width: 300px;
        justify-content: center;
      }
      
      .tournament-title {
        font-size: 2.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo-container">
      <img src="https://i.ibb.co/JRZzccKb/image.jpg" alt="PRIDE ESPORTS COMMUNITY" class="tournament-logo">
    </div>
    <h1 class="tournament-title">Free Fire Tournament</h1>
    <p class="tournament-subtitle">OFFICIAL POINTS TABLE</p>
    <div class="pec-brand">PRIDE ESPORTS COMMUNITY</div>
  </div>

  <div class="controls">
    <button class="btn btn-primary" id="calculateButton">
      <i class="fas fa-calculator"></i> Calculate
    </button>
    <button class="btn btn-secondary" id="nextButton">
      <i class="fas fa-forward"></i> Next Match
    </button>
    <button class="btn btn-warning" id="finalButton">
      <i class="fas fa-trophy"></i> Final Result
    </button>
    <button class="btn btn-danger" id="resetButton">
      <i class="fas fa-redo"></i> Reset
    </button>
    <button class="btn btn-success" id="downloadButton">
      <i class="fas fa-download"></i> Download Result
    </button>
  </div>

  <div class="table-container">
    <table id="pointsTable">
      <thead>
        <tr>
          <th>Rank</th>
          <th>Team Name</th>
          <th>Win</th>
          <th>Kill Pts</th>
          <th>Placement Rank</th>
          <th>Placement Pts</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <!-- Rows will be generated by JavaScript -->
      </tbody>
    </table>
  </div>

  <div class="footer">
    <p>Free Fire Tournament Points System | Â© 2025 PRIDE ESPORTS COMMUNITY</p>
  </div>

  <!-- Download Container (hidden by default) -->
  <div id="downloadContainer">
    <div id="downloadPreview">
      <div class="download-header">
        <img src="https://i.ibb.co/JRZzccKb/image.jpg" alt="PRIDE ESPORTS COMMUNITY" class="download-logo">
        <div class="download-brand">PRIDE ESPORTS COMMUNITY</div>
        <h2 class="download-title">FREE FIRE TOURNAMENT</h2>
        <h3 class="download-subtitle">OVERALL STANDINGS</h3>
      </div>
      <table id="downloadTable">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Team Name</th>
            <th>Wins</th>
            <th>Kills</th>
            <th>Placement Pts</th>
            <th>Total Pts</th>
          </tr>
        </thead>
        <tbody>
          <!-- Download table content will be generated by JavaScript -->
        </tbody>
      </table>
    </div>
    <div style="margin-top: 20px;">
      <button class="btn btn-success" id="saveImageBtn" style="margin: 5px;">
        <i class="fas fa-download"></i> Save as PNG
      </button>
      <button class="btn btn-danger" id="closeDownloadBtn" style="margin: 5px;">
        <i class="fas fa-times"></i> Close
      </button>
    </div>
  </div>

  <script>
    // Initialize table with 12 teams
    const table = document.getElementById('pointsTable');
    const tbody = table.querySelector('tbody');
    
    for (let i = 1; i <= 12; i++) {
      const row = document.createElement('tr');
      
      // Rank cell
      const rankCell = document.createElement('td');
      rankCell.className = 'rank-cell';
      rankCell.textContent = i;
      
      // Team Name cell (editable)
      const teamCell = document.createElement('td');
      teamCell.className = 'team-name';
      teamCell.contentEditable = true;
      
      // Win cell (editable)
      const winCell = document.createElement('td');
      winCell.contentEditable = true;
      
      // Kill Points cell (editable)
      const killCell = document.createElement('td');
      killCell.contentEditable = true;
      
      // Placement Rank cell (editable)
      const placementRankCell = document.createElement('td');
      placementRankCell.contentEditable = true;
      
      // Placement Points cell (calculated)
      const placementPointsCell = document.createElement('td');
      
      // Total Points cell (calculated)
      const totalCell = document.createElement('td');
      totalCell.className = 'total-cell';
      
      // Append all cells to the row
      row.appendChild(rankCell);
      row.appendChild(teamCell);
      row.appendChild(winCell);
      row.appendChild(killCell);
      row.appendChild(placementRankCell);
      row.appendChild(placementPointsCell);
      row.appendChild(totalCell);
      
      // Append row to table body
      tbody.appendChild(row);
    }

    // Application logic
    let teamMemory = [];
    let finalCalculated = false;

    function checkBooyahExists() {
      const rows = table.querySelectorAll('tbody tr');
      for (let row of rows) {
        const winCell = row.querySelectorAll('td')[2];
        const win = parseInt(winCell.textContent.trim()) || 0;
        if (win > 0) return true;
      }
      return false;
    }

    function validateInputs() {
      const booyahExists = checkBooyahExists();
      const rows = table.querySelectorAll('tbody tr');

      for (let row of rows) {
        const cells = row.querySelectorAll('td');
        const teamName = cells[1].textContent.trim();
        const win = cells[2].textContent.trim();
        const kill = cells[3].textContent.trim();
        const placement = cells[4].textContent.trim();

        if (teamName !== "") {
          if (win === "" && kill === "" && placement === "") {
            alert("âš ï¸ Insufficient values entered!");
            return false;
          }
          if (!booyahExists && placement === "") {
            alert("âš ï¸ Placement rank required when no team has a win!");
            return false;
          }
        }
      }
      return true;
    }

    function calculateRowTotal(row) {
      const cells = row.querySelectorAll('td');
      let win = parseInt(cells[2].textContent.trim()) || 0;
      let kill = parseInt(cells[3].textContent.trim()) || 0;
      let placementRank = parseInt(cells[4].textContent.trim()) || 0;
      let placementPoints = 0;

      if (win > 0) {
        // FIX: Multiply placement points by number of wins
        placementPoints = win * 12;
        cells[4].textContent = 1; // auto placement
      } else {
        switch (placementRank) {
          case 1: placementPoints = 12; break;
          case 2: placementPoints = 9; break;
          case 3: placementPoints = 8; break;
          case 4: placementPoints = 7; break;
          case 5: placementPoints = 6; break;
          case 6: placementPoints = 5; break;
          case 7: placementPoints = 4; break;
          case 8: placementPoints = 3; break;
          case 9: placementPoints = 2; break;
          case 10: placementPoints = 1; break;
          default: placementPoints = 0;
        }
      }

      cells[5].textContent = placementPoints;
      cells[6].textContent = placementPoints + kill;
    }

    function realTimeUpdate() {
      const rows = table.querySelectorAll('tbody tr');
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        // Add event listeners to Win, Kill, and Placement Rank cells
        cells[2].addEventListener('input', () => calculateRowTotal(row));
        cells[3].addEventListener('input', () => calculateRowTotal(row));
        cells[4].addEventListener('input', () => calculateRowTotal(row));
      });
    }

    // Initialize real-time updates
    realTimeUpdate();

    function sortTable() {
      const tbody = table.querySelector('tbody');
      const rows = Array.from(tbody.querySelectorAll('tr'));

      rows.sort((a, b) => {
        const aTotal = parseInt(a.querySelectorAll('td')[6].textContent) || 0;
        const bTotal = parseInt(b.querySelectorAll('td')[6].textContent) || 0;
        return bTotal - aTotal;
      });

      rows.forEach((row, index) => {
        row.querySelector('.rank-cell').textContent = index + 1;
        tbody.appendChild(row);
      });
    }

    // Button event listeners
    document.getElementById('calculateButton').addEventListener('click', () => {
      if (!validateInputs()) return;
      sortTable();
    });

    document.getElementById('nextButton').addEventListener('click', () => {
      if (!validateInputs()) return;
      
      const rows = table.querySelectorAll('tbody tr');
      const matchData = [];
      
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        const teamName = cells[1].textContent.trim();
        const win = parseInt(cells[2].textContent.trim()) || 0;
        const kill = parseInt(cells[3].textContent.trim()) || 0;
        const placementRank = parseInt(cells[4].textContent.trim()) || 0;
        const placementPoints = parseInt(cells[5].textContent.trim()) || 0;
        
        if (teamName) {
          matchData.push({ 
            teamName, 
            win, 
            kill, 
            placementRank,
            placementPoints 
          });
        }
      });
      
      teamMemory.push(matchData);

      // Clear input fields for next match
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        for (let i = 2; i <= 6; i++) cells[i].textContent = '';
      });

      finalCalculated = false;
      alert("âœ… Match data saved! Enter next match data.");
    });

    document.getElementById('finalButton').addEventListener('click', () => {
      if (finalCalculated) {
        alert("âš ï¸ Final results already calculated!");
        return;
      }
      if (!validateInputs()) return;

      // Save current match data
      const currentMatch = [];
      const rows = table.querySelectorAll('tbody tr');
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        const teamName = cells[1].textContent.trim();
        const win = parseInt(cells[2].textContent.trim()) || 0;
        const kill = parseInt(cells[3].textContent.trim()) || 0;
        const placementRank = parseInt(cells[4].textContent.trim()) || 0;
        const placementPoints = parseInt(cells[5].textContent.trim()) || 0;
        
        if (teamName) {
          currentMatch.push({ 
            teamName, 
            win, 
            kill, 
            placementRank,
            placementPoints 
          });
        }
      });
      
      // Add current match to memory
      teamMemory.push(currentMatch);

      // Enhanced data structure for tie-breaker
      const teamStats = {};

      // Calculate final scores from all matches with tie-breaker data
      teamMemory.forEach(match => {
        match.forEach(team => {
          if (!teamStats[team.teamName]) {
            teamStats[team.teamName] = { 
              totalKills: 0, 
              totalPlacementPoints: 0,
              totalWins: 0,
              placementRanks: [], // Store all placement ranks for tie-breaking
              totalPoints: 0
            };
          }
          
          teamStats[team.teamName].totalKills += team.kill;
          teamStats[team.teamName].totalPlacementPoints += team.placementPoints;
          teamStats[team.teamName].totalWins += team.win;
          teamStats[team.teamName].totalPoints += team.kill + team.placementPoints;
          
          // Store placement ranks for tie-breaking (only if not a win)
          if (team.win === 0 && team.placementRank > 0) {
            teamStats[team.teamName].placementRanks.push(team.placementRank);
          } else if (team.win > 0) {
            // For each win, add a rank 1 placement
            for (let i = 0; i < team.win; i++) {
              teamStats[team.teamName].placementRanks.push(1); // Each win = Rank 1
            }
          }
        });
      });

      // Prepare teams for sorting with tie-breaker
      const teamsData = [];
      for (const teamName in teamStats) {
        teamsData.push({
          teamName: teamName,
          totalPoints: teamStats[teamName].totalPoints,
          totalKills: teamStats[teamName].totalKills,
          totalWins: teamStats[teamName].totalWins,
          placementRanks: teamStats[teamName].placementRanks.sort((a, b) => a - b) // Sort ranks ascending (lower is better)
        });
      }

      // Sort with tie-breaker logic
      teamsData.sort((a, b) => {
        // Primary sort: Total Points (descending)
        if (b.totalPoints !== a.totalPoints) {
          return b.totalPoints - a.totalPoints;
        }
        
        // TIE-BREAKER 1: Compare placement ranks (better placements win)
        // Sort both teams' placement ranks in ascending order
        const aRanks = [...a.placementRanks].sort((x, y) => x - y);
        const bRanks = [...b.placementRanks].sort((x, y) => x - y);
        
        // Compare placement by placement (lower rank is better)
        const minLength = Math.min(aRanks.length, bRanks.length);
        for (let i = 0; i < minLength; i++) {
          if (aRanks[i] !== bRanks[i]) {
            return aRanks[i] - bRanks[i]; // Lower placement rank wins
          }
        }
        
        // If all compared placements are equal, team with more placements wins
        if (aRanks.length !== bRanks.length) {
          return bRanks.length - aRanks.length; // More placements is better
        }
        
        // TIE-BREAKER 2: Total Kills (higher kills win)
        if (b.totalKills !== a.totalKills) {
          return b.totalKills - a.totalKills;
        }
        
        // If still tied, maintain original order
        return 0;
      });

      // Clear and rebuild table with sorted results
      const tbody = table.querySelector('tbody');
      const currentRows = Array.from(tbody.querySelectorAll('tr'));
      
      // Remove existing rows
      currentRows.forEach(row => tbody.removeChild(row));
      
      // Create new rows in sorted order
      teamsData.forEach((team, index) => {
        const newRow = document.createElement('tr');
        
        // Rank cell - shows final tournament ranking
        const rankCell = document.createElement('td');
        rankCell.className = 'rank-cell';
        rankCell.textContent = index + 1;
        newRow.appendChild(rankCell);
        
        // Team Name cell
        const teamCell = document.createElement('td');
        teamCell.className = 'team-name';
        teamCell.textContent = team.teamName;
        newRow.appendChild(teamCell);
        
        // Win cell (total wins)
        const winCell = document.createElement('td');
        winCell.textContent = team.totalWins;
        newRow.appendChild(winCell);
        
        // Kill Points cell (total kills)
        const killCell = document.createElement('td');
        killCell.textContent = team.totalKills;
        newRow.appendChild(killCell);
        
        // Placement Rank cell - shows final tournament ranking (same as Rank column)
        const placementRankCell = document.createElement('td');
        placementRankCell.textContent = index + 1; // Final tournament rank
        newRow.appendChild(placementRankCell);
        
        // Placement Points cell (total placement points)
        const placementPointsCell = document.createElement('td');
        placementPointsCell.textContent = team.totalPoints - team.totalKills;
        newRow.appendChild(placementPointsCell);
        
        // Total Points cell
        const totalCell = document.createElement('td');
        totalCell.className = 'total-cell';
        totalCell.textContent = team.totalPoints;
        newRow.appendChild(totalCell);
        
        tbody.appendChild(newRow);
      });

      finalCalculated = true;
      
      // Check if any ties were resolved by tie-breaker
      const tiedTeams = teamsData.filter((team, index, array) => {
        if (index === 0) return false;
        return team.totalPoints === array[index - 1].totalPoints;
      });
      
      if (tiedTeams.length > 0) {
        alert("ðŸ† Final Result Calculated! Tie-breaker rules were applied for teams with equal points.");
      } else {
        alert("ðŸ† Final tournament results calculated!");
      }
    });

    document.getElementById('resetButton').addEventListener('click', () => {
      if (!confirm("Reset all points but keep team names?")) return;
      teamMemory = [];
      finalCalculated = false;
      
      // Clear all rows and recreate with empty data
      const tbody = table.querySelector('tbody');
      const currentRows = Array.from(tbody.querySelectorAll('tr'));
      currentRows.forEach(row => tbody.removeChild(row));
      
      // Recreate rows with empty data
      for (let i = 1; i <= 12; i++) {
        const row = document.createElement('tr');
        
        const rankCell = document.createElement('td');
        rankCell.className = 'rank-cell';
        rankCell.textContent = i;
        
        const teamCell = document.createElement('td');
        teamCell.className = 'team-name';
        teamCell.contentEditable = true;
        
        const winCell = document.createElement('td');
        winCell.contentEditable = true;
        
        const killCell = document.createElement('td');
        killCell.contentEditable = true;
        
        const placementRankCell = document.createElement('td');
        placementRankCell.contentEditable = true;
        
        const placementPointsCell = document.createElement('td');
        
        const totalCell = document.createElement('td');
        totalCell.className = 'total-cell';
        
        row.appendChild(rankCell);
        row.appendChild(teamCell);
        row.appendChild(winCell);
        row.appendChild(killCell);
        row.appendChild(placementRankCell);
        row.appendChild(placementPointsCell);
        row.appendChild(totalCell);
        
        tbody.appendChild(row);
      }
      
      // Reinitialize real-time updates
      realTimeUpdate();
    });

    // Download functionality
    document.getElementById('downloadButton').addEventListener('click', () => {
      if (!finalCalculated) {
        alert("âš ï¸ Please calculate Final Result first before downloading!");
        return;
      }

      // Get current table data
      const rows = table.querySelectorAll('tbody tr');
      const downloadTbody = document.querySelector('#downloadTable tbody');
      
      // Clear existing download table
      downloadTbody.innerHTML = '';
      
      // Populate download table
      rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        const newRow = document.createElement('tr');
        
        // Rank
        const rankCell = document.createElement('td');
        rankCell.className = 'rank-cell';
        rankCell.textContent = cells[0].textContent;
        newRow.appendChild(rankCell);
        
        // Team Name
        const teamCell = document.createElement('td');
        teamCell.textContent = cells[1].textContent;
        newRow.appendChild(teamCell);
        
        // Wins
        const winCell = document.createElement('td');
        winCell.textContent = cells[2].textContent;
        newRow.appendChild(winCell);
        
        // Kills
        const killCell = document.createElement('td');
        killCell.textContent = cells[3].textContent;
        newRow.appendChild(killCell);
        
        // Placement Points
        const placementCell = document.createElement('td');
        placementCell.textContent = cells[5].textContent;
        newRow.appendChild(placementCell);
        
        // Total Points
        const totalCell = document.createElement('td');
        totalCell.className = 'total-cell';
        totalCell.textContent = cells[6].textContent;
        newRow.appendChild(totalCell);
        
        downloadTbody.appendChild(newRow);
      });
      
      // Show download container
      document.getElementById('downloadContainer').style.display = 'block';
    });

    // Save as image functionality
    document.getElementById('saveImageBtn').addEventListener('click', () => {
      const downloadPreview = document.getElementById('downloadPreview');
      
      html2canvas(downloadPreview, {
        backgroundColor: '#1a1a2e',
        scale: 2, // Higher quality
        useCORS: true,
        logging: false
      }).then(canvas => {
        // Convert canvas to image
        const image = canvas.toDataURL('image/png');
        
        // Create download link
        const link = document.createElement('a');
        link.download = 'PRIDE_ESPORTS_OVERALL_STANDINGS.png';
        link.href = image;
        link.click();
      });
    });

    // Close download container
    document.getElementById('closeDownloadBtn').addEventListener('click', () => {
      document.getElementById('downloadContainer').style.display = 'none';
    });
  </script>
</body>
</html>
